<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>抽一发</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B6B',
                        secondary: '#4ECDC4',
                        accent: '#FFD166',
                        dark: '#1E293B',
                        light: '#F1F5F9',
                        gold: '#FFD700',
                        silver: '#C0C0C0',
                        bronze: '#CD7F32'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .text-shadow-lg {
                text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }
            .animation-delay-100 {
                animation-delay: 100ms;
            }
            .animation-delay-200 {
                animation-delay: 200ms;
            }
            .animation-delay-300 {
                animation-delay: 300ms;
            }
        }
 
        @keyframes lottery-animation {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }
 
        @keyframes falling {
            0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
 
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
 
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
 
        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
            100% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
        }
 
        .lottery-animation {
            animation: lottery-animation 0.2s infinite;
        }
 
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
 
        .animate-pulse-slow {
            animation: pulse 2s ease-in-out infinite;
        }
 
        .animate-glow {
            animation: glow 2s ease-in-out infinite;
        }
 
        .confetti {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
        }
 
        .firework {
            position: fixed;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            z-index: 9999;
            pointer-events: none;
        }
 
        .firework-burst {
            position: fixed;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            z-index: 9999;
            pointer-events: none;
        }
 
        /* 移动端优化 */
        .lottery-container {
            width: 100%;
            max-width: 100%;
            padding: 0 1rem;
        }
 
        .lottery-name {
            font-size: clamp(2.5rem, 8vw, 4rem);
            line-height: 1.2;
        }
 
        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            max-width: 300px;
        }
 
        .control-buttons button {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
        }
 
        @media (min-width: 768px) {
            .control-buttons {
                flex-direction: row;
                max-width: 100%;
            }
            .control-buttons button {
                width: auto;
                padding: 1rem 2rem;
            }
        }
 
        /* 奖品卡片样式 */
        .prize-card {
            background: linear-gradient(135deg, #FFD166, #FF9E6D);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            transition: transform 0.3s ease;
        }
 
        .prize-card:hover {
            transform: translateY(-5px);
        }
 
        .prize-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #FFD166, #FF9E6D);
        }
 
        .prize-icon {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2.5rem;
            color: white;
        }
 
        /* 倒计时样式 */
        .countdown {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            margin-top: 1rem;
        }
 
        .countdown-time {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 0.5rem;
        }
        
        /* 抽奖次数显示 */
        .draws-left {
            background: rgba(255, 107, 107, 0.2);
            border-radius: 10px;
            padding: 0.5rem 1rem;
            text-align: center;
            margin-top: 1rem;
            font-weight: bold;
            color: #FF6B6B;
        }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-primary/20 to-secondary/20 min-h-screen flex flex-col transition-all duration-500">
    <!-- 主抽奖界面 -->
    <div id="lotteryScreen" class="flex-1 flex flex-col items-center justify-center p-4">
        <!-- 标题区域 -->
        <header class="py-4 text-center w-full">
            <h1 id="mainTitle" class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold text-dark mb-2 text-shadow">幸运抽奖</h1>
            <p id="subtitle" class="text-[clamp(0.9rem,2vw,1.1rem)] text-gray-600">每日两次抽奖机会，只有月卡和年卡用户的中奖记录才有效，中奖会验证卡密</p>
        </header>
 
        <!-- 奖品展示区域 -->
        <div class="w-full max-w-md mb-6 mt-2">
            <div class="prize-card p-6 text-center text-white">
                <div class="prize-icon">
                    <i class="fa fa-crown"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">今日奖品</h3>
                <p id="prizeName" class="text-lg font-semibold">年VIP会员 / 周VIP会员</p>
                <p class="text-sm opacity-90 mt-2">价值 ¥*** / ¥**</p>
            </div>
        </div>
 
        <!-- 抽奖区域 -->
        <main class="flex-1 flex items-center justify-center w-full lottery-container">
            <div id="lotteryContainer" class="w-full h-full flex items-center justify-center">
                <!-- 抽奖结果显示区域 -->
            </div>
        </main>
 
        <!-- 控制区域 -->
        <footer class="py-6 w-full flex justify-center">
            <div class="control-buttons">
                <button id="startButton" class="px-6 py-4 bg-primary hover:bg-primary/90 text-white text-xl font-bold rounded-xl transition-colors shadow-lg hover:shadow-xl transform hover:scale-105 animate-pulse-slow">
                    <i class="fa fa-play mr-2"></i>开始抽奖
                </button>
                <button id="stopButton" class="hidden px-6 py-4 bg-red-500 hover:bg-red-600 text-white text-xl font-bold rounded-xl transition-colors shadow-lg hover:shadow-xl transform hover:scale-105">
                    <i class="fa fa-stop mr-2"></i>停止抽奖
                </button>
                <button id="viewWinnersButton" class="px-6 py-4 bg-accent hover:bg-accent/90 text-white text-xl font-bold rounded-xl transition-colors shadow-lg hover:shadow-xl transform hover:scale-105">
                    <i class="fa fa-trophy mr-2"></i>中奖记录
                </button>
            </div>
        </footer>

        <!-- 抽奖次数显示 -->
        <div id="drawsLeftContainer" class="draws-left">
            今日剩余抽奖次数: <span id="drawsLeft">2</span> 次
        </div>

        <!-- 倒计时显示 -->
        <div id="countdownContainer" class="countdown hidden">
            <p>下次抽奖剩余时间：</p>
            <div id="countdownTime" class="countdown-time">00:00:00</div>
        </div>
    </div>
 
    <!-- 中奖名单界面 -->
    <div id="winnersScreen" class="fixed inset-0 bg-white z-40 hidden overflow-auto">
        <div class="p-4">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-dark">中奖记录</h2>
                <button id="backToMainButton" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors">
                    <i class="fa fa-arrow-left mr-2"></i>返回
                </button>
            </div>
            <div id="winnersList" class="space-y-4">
                <!-- 中奖记录将在这里动态生成 -->
            </div>
            <div class="flex justify-center gap-4 mt-8">
                <button id="clearWinnersButton" class="px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
                    <i class="fa fa-trash mr-2"></i>清空记录
                </button>
            </div>
        </div>
    </div>
 
    <!-- 音效元素 -->
    <audio id="drawSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" type="audio/mpeg">
    </audio>

    <script>
        // 奖品配置
        const prizes = [
            {
                name: "年VIP会员",
                value: "¥***",
                icon: "fa-crown",
                rate: 0.001 // 0.1%中奖率
            },
            {
                name: "周VIP会员",
                value: "¥**",
                icon: "fa-star",
                rate: 0.001 // 0.1%中奖率
            }
        ];

        // 数据结构定义
        const data = {
            participants: [], // 参与者名单
            winners: [], // 中奖记录
            lastDrawTime: null, // 上次抽奖时间
            drawsLeft: 2, // 剩余抽奖次数
            settings: {
                lotterySpeed: 3, // 抽奖速度（1-10，10最快）
                enableDrawSound: true, // 抽奖音效
                enableWinSound: true, // 中奖音效
                enableFireworks: true, // 烟花特效
            }
        };
 
        // 应用状态
        const state = {
            isDrawing: false, // 是否正在抽奖
            drawInterval: null, // 抽奖定时器
            canDraw: true // 是否可以抽奖
        };
 
        // DOM元素引用
        const elements = {
            // 主界面元素
            lotteryScreen: document.getElementById('lotteryScreen'),
            mainTitle: document.getElementById('mainTitle'),
            subtitle: document.getElementById('subtitle'),
            lotteryContainer: document.getElementById('lotteryContainer'),
            startButton: document.getElementById('startButton'),
            stopButton: document.getElementById('stopButton'),
            viewWinnersButton: document.getElementById('viewWinnersButton'),
            prizeName: document.getElementById('prizeName'),
            countdownContainer: document.getElementById('countdownContainer'),
            countdownTime: document.getElementById('countdownTime'),
            drawsLeftContainer: document.getElementById('drawsLeftContainer'),
            drawsLeft: document.getElementById('drawsLeft'),
             
            // 中奖名单界面元素
            winnersScreen: document.getElementById('winnersScreen'),
            backToMainButton: document.getElementById('backToMainButton'),
            winnersList: document.getElementById('winnersList'),
            clearWinnersButton: document.getElementById('clearWinnersButton'),
             
            // 音效元素
            drawSound: document.getElementById('drawSound'),
            winSound: document.getElementById('winSound')
        };

        // 禁用右键菜单
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            alert('右键功能已禁用');
        });

        // 禁用开发者工具快捷键
        document.addEventListener('keydown', function(e) {
            // 禁用F12
            if (e.key === 'F12') {
                e.preventDefault();
                alert('开发者工具已禁用');
            }
            // 禁用Ctrl+Shift+I
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                alert('开发者工具已禁用');
            }
            // 禁用Ctrl+Shift+J
            if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                e.preventDefault();
                alert('开发者工具已禁用');
            }
            // 禁用Ctrl+Shift+C
            if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                alert('开发者工具已禁用');
            }
            // 禁用Ctrl+U
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                alert('查看源代码已禁用');
            }
        });

        // 更新奖品显示
        function updatePrizeDisplay() {
            elements.prizeName.textContent = "年VIP会员 / 周VIP会员";
        }
 
        // 检查是否可以抽奖
        function checkDrawAvailability() {
            // 检查抽奖次数
            if (data.drawsLeft <= 0) {
                state.canDraw = false;
                elements.startButton.disabled = true;
                elements.startButton.classList.remove('animate-pulse-slow');
                elements.countdownContainer.classList.remove('hidden');
                
                // 检查是否需要重置抽奖次数
                if (!data.lastDrawTime) {
                    resetDraws();
                    return;
                }
                
                const now = new Date().getTime();
                const lastDraw = new Date(data.lastDrawTime).getTime();
                const twentyFourHours = 24 * 60 * 60 * 1000; // 24小时毫秒数
                
                if (now - lastDraw >= twentyFourHours) {
                    resetDraws();
                } else {
                    // 计算剩余时间
                    const remainingTime = twentyFourHours - (now - lastDraw);
                    startCountdown(remainingTime);
                }
            } else {
                state.canDraw = true;
                elements.countdownContainer.classList.add('hidden');
                elements.startButton.disabled = false;
                elements.startButton.classList.add('animate-pulse-slow');
            }
            
            // 更新抽奖次数显示
            updateDrawsLeftDisplay();
        }
        
        // 重置抽奖次数
        function resetDraws() {
            data.drawsLeft = 2;
            data.lastDrawTime = null;
            localStorage.removeItem('lastDrawTime');
            localStorage.setItem('drawsLeft', data.drawsLeft);
            checkDrawAvailability();
        }
        
        // 更新抽奖次数显示
        function updateDrawsLeftDisplay() {
            elements.drawsLeft.textContent = data.drawsLeft;
        }
        
        // 开始倒计时
        function startCountdown(remainingTime) {
            function updateCountdown() {
                const hours = Math.floor(remainingTime / (1000 * 60 * 60));
                const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);
                
                elements.countdownTime.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                remainingTime -= 1000;
                
                if (remainingTime < 0) {
                    clearInterval(countdownInterval);
                    resetDraws();
                }
            }
            
            updateCountdown();
            const countdownInterval = setInterval(updateCountdown, 1000);
        }
 
        // 更新中奖名单显示
        function updateWinnersList() {
            elements.winnersList.innerHTML = '';
             
            if (data.winners.length === 0) {
                elements.winnersList.innerHTML = `
                  <div class="py-16 text-center text-gray-400">
                    <i class="fa fa-trophy text-5xl mb-6 block"></i>
                    <p class="text-xl">暂无中奖记录</p>
                  </div>
                `;
                return;
            }
             
            // 添加"恭喜"标题
            const congratulationTitle = document.createElement('div');
            congratulationTitle.className = 'text-center mb-8';
            congratulationTitle.innerHTML = '<h3 class="text-2xl font-bold text-primary">中奖记录</h3>';
            elements.winnersList.appendChild(congratulationTitle);
             
            // 中奖记录列表
            data.winners.forEach((winner, index) => {
                const card = document.createElement('div');
                card.className = 'bg-white border border-gray-200 rounded-xl p-4 shadow-sm';
                card.innerHTML = `
                  <div class="flex justify-between items-center">
                    <div>
                      <h4 class="text-lg font-bold text-gray-800">${winner.name}</h4>
                      <p class="text-sm text-gray-500">${winner.time}</p>
                    </div>
                    <div class="text-right">
                      <p class="text-sm font-semibold text-primary">${winner.prize}</p>
                      <p class="text-xs text-gray-500">${winner.value}</p>
                    </div>
                  </div>
                `;
                elements.winnersList.appendChild(card);
            });
        }
 
        // 开始抽奖
        function startLottery() {
            if (!state.canDraw) {
                alert('今日抽奖次数已用完，请24小时后再试！');
                return;
            }
            
            if (data.participants.length === 0) {
                alert('请先添加参与者名单！');
                loadExampleParticipants();
                return;
            }
             
            state.isDrawing = true;
            elements.startButton.classList.add('hidden');
            elements.stopButton.classList.remove('hidden');
             
            // 停止获奖音效并重置其状态
            if (elements.winSound) {
                elements.winSound.pause();
                elements.winSound.currentTime = 0;
            }
             
            // 播放抽奖音效
            if (data.settings.enableDrawSound && elements.drawSound) {
                elements.drawSound.currentTime = 0;
                elements.drawSound.play().catch(e => console.log('无法播放音效:', e));
            }
             
            // 计算抽奖间隔时间（速度越快，间隔越小）
            const intervalTime = 300 - (data.settings.lotterySpeed * 15);
             
            // 设置抽奖循环
            state.drawInterval = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * data.participants.length);
                // 直接显示在抽奖容器中
                elements.lotteryContainer.textContent = data.participants[randomIndex];
            }, intervalTime);
        }
 
        // 停止抽奖
        function stopLottery() {
            if (!state.isDrawing) return;
             
            state.isDrawing = false;
            clearInterval(state.drawInterval);
            elements.startButton.classList.remove('hidden');
            elements.stopButton.classList.add('hidden');
             
            // 停止抽奖音效
            if (elements.drawSound) {
                elements.drawSound.pause();
            }
             
            // 选择中奖者
            const winner = selectWinner();
             
            // 显示中奖者
            displayWinner(winner);
             
            // 播放中奖音效
            if (data.settings.enableWinSound && elements.winSound && winner) {
                elements.winSound.currentTime = 0;
                elements.winSound.play().catch(e => console.log('无法播放音效:', e));
            }
             
            // 添加特效
            if (data.settings.enableFireworks && winner) {
                createFireworks();
                createConfetti();
            }
             
            // 保存中奖记录
            if (winner) {
                saveWinner(winner);
            }
            
            // 减少抽奖次数
            data.drawsLeft--;
            localStorage.setItem('drawsLeft', data.drawsLeft);
            
            // 如果是最后一次抽奖，记录抽奖时间
            if (data.drawsLeft === 0) {
                data.lastDrawTime = new Date().toISOString();
                localStorage.setItem('lastDrawTime', data.lastDrawTime);
            }
            
            // 更新抽奖状态
            checkDrawAvailability();
        }
 
        // 选择中奖者
        function selectWinner() {
            // 随机决定是否中奖
            const randomValue = Math.random();
            let selectedPrize = null;
            
            // 检查是否中奖（年卡0.1% + 周卡20% = 20.1%总中奖率）
            if (randomValue < prizes[0].rate) {
                selectedPrize = prizes[0]; // 年卡
            } else if (randomValue < prizes[0].rate + prizes[1].rate) {
                selectedPrize = prizes[1]; // 周卡
            }
            
            if (selectedPrize) {
                const randomIndex = Math.floor(Math.random() * data.participants.length);
                return {
                    name: data.participants[randomIndex],
                    prize: selectedPrize.name,
                    value: selectedPrize.value
                };
            } else {
                return null;
            }
        }
 
        // 显示中奖者
        function displayWinner(winner) {
            // 清空当前显示
            elements.lotteryContainer.innerHTML = '';
             
            // 创建中奖者显示容器
            const winnerContainer = document.createElement('div');
            winnerContainer.className = 'w-full h-full flex flex-col items-center justify-center p-4';
             
            if (winner) {
                // 中奖标题
                const title = document.createElement('h2');
                title.className = 'text-2xl font-bold text-primary mb-4 text-center';
                title.textContent = '恭喜中奖！';
                winnerContainer.appendChild(title);
                 
                // 中奖者卡片
                const winnerCard = document.createElement('div');
                winnerCard.className = 'bg-white rounded-2xl p-6 shadow-lg text-center max-w-md w-full mb-6 animate-glow';
                 
                const name = document.createElement('div');
                name.className = 'text-3xl font-bold text-gray-800 mb-4';
                name.textContent = winner.name;
                winnerCard.appendChild(name);
                 
                const prizeInfo = document.createElement('div');
                prizeInfo.className = 'text-xl text-primary font-semibold mb-2';
                prizeInfo.textContent = winner.prize;
                winnerCard.appendChild(prizeInfo);
                 
                const prizeValue = document.createElement('div');
                prizeValue.className = 'text-lg text-gray-600';
                prizeValue.textContent = winner.value;
                winnerCard.appendChild(prizeValue);
                 
                winnerContainer.appendChild(winnerCard);
            } else {
                // 未中奖显示
                const message = document.createElement('div');
                message.className = 'text-2xl font-bold text-gray-600 text-center';
                message.textContent = '很遗憾，这次没有中奖';
                winnerContainer.appendChild(message);
                
                const icon = document.createElement('div');
                icon.className = 'text-5xl text-gray-400 my-6';
                icon.innerHTML = '<i class="fa fa-frown-o"></i>';
                winnerContainer.appendChild(icon);
                
                const encouragement = document.createElement('p');
                encouragement.className = 'text-gray-500';
                encouragement.textContent = '明天再来试试吧！';
                winnerContainer.appendChild(encouragement);
            }
             
            // 返回按钮
            const backButton = document.createElement('button');
            backButton.className = 'px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-lg';
            backButton.innerHTML = '<i class="fa fa-arrow-left mr-2"></i>返回';
            backButton.onclick = () => {
                resetLotteryDisplay();
            };
             
            winnerContainer.appendChild(backButton);
             
            // 添加到容器
            elements.lotteryContainer.appendChild(winnerContainer);
        }
 
        // 重置抽奖显示
        function resetLotteryDisplay() {
            elements.lotteryContainer.innerHTML = '';
        }
 
        // 保存中奖记录
        function saveWinner(winner) {
            if (!winner) return;
            
            const now = new Date();
            const formattedTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
             
            data.winners.unshift({
                name: winner.name,
                prize: winner.prize,
                value: winner.value,
                time: formattedTime
            });
             
            // 只保留最近20条记录
            if (data.winners.length > 20) {
                data.winners = data.winners.slice(0, 20);
            }
             
            saveData();
            updateWinnersList();
        }
 
        // 创建烟花效果
        function createFireworks() {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD166', '#96CEB4', '#DDA0DD'];
             
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                     
                    // 随机位置
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight * 0.7;
                     
                    firework.style.left = `${x}px`;
                    firework.style.top = `${y}px`;
                     
                    // 随机颜色
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.backgroundColor = color;
                     
                    document.body.appendChild(firework);
                     
                    // 爆炸效果
                    setTimeout(() => {
                        createFireworkBurst(x, y, color);
                        document.body.removeChild(firework);
                    }, 500);
                }, i * 300);
            }
        }
 
        // 创建烟花爆炸效果
        function createFireworkBurst(x, y, color) {
            const particleCount = 20;
             
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework-burst';
                 
                // 设置位置
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.backgroundColor = color;
                 
                // 计算随机方向和距离
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 80 + 40;
                const endX = Math.cos(angle) * distance;
                const endY = Math.sin(angle) * distance;
                 
                // 添加动画
                particle.style.transition = `transform ${Math.random() * 1.5 + 0.5}s ease-out, opacity 1.5s ease-out`;
                 
                // 添加到DOM
                document.body.appendChild(particle);
                 
                // 触发重排
                particle.offsetWidth;
                 
                // 应用变换
                particle.style.transform = `translate(${endX}px, ${endY}px)`;
                particle.style.opacity = '0';
                 
                // 移除粒子
                setTimeout(() => {
                    if (particle.parentNode) {
                        document.body.removeChild(particle);
                    }
                }, 1500);
            }
        }
 
        // 创建彩纸效果
        function createConfetti() {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD166', '#96CEB4', '#DDA0DD'];
            const confettiCount = 100;
             
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                 
                // 随机位置
                const x = Math.random() * window.innerWidth;
                confetti.style.left = `${x}px`;
                confetti.style.top = `${-20}px`;
                 
                // 随机颜色
                const color = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.backgroundColor = color;
                 
                // 随机大小
                const size = Math.random() * 8 + 4;
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                 
                // 随机动画持续时间
                const duration = Math.random() * 3 + 2;
                confetti.style.animation = `falling ${duration}s linear forwards`;
                 
                // 随机旋转
                const rotation = Math.random() * 360;
                confetti.style.transform = `rotate(${rotation}deg)`;
                 
                document.body.appendChild(confetti);
                 
                // 移除彩纸
                setTimeout(() => {
                    if (confetti.parentNode) {
                        document.body.removeChild(confetti);
                    }
                }, duration * 1000);
            }
        }
 
        // 加载示例参与者名单
        function loadExampleParticipants() {
            const exampleNames = ['年VIP', '周VIP', '周VIP', '谢谢惠顾', '年VIP', '周VIP', '周VIP', '谢谢惠顾', '年VIP', '周vip'];
            data.participants = exampleNames;
            saveData();
        }
 
        // 清空中奖名单
        function clearWinners() {
            if (confirm('确定要清空中奖记录吗？此操作不可恢复。')) {
                data.winners = [];
                updateWinnersList();
                saveData();
            }
        }
 
        // 保存数据到本地存储
        function saveData() {
            localStorage.setItem('lotteryParticipants', JSON.stringify(data.participants));
            localStorage.setItem('lotteryWinners', JSON.stringify(data.winners));
            localStorage.setItem('lotterySettings', JSON.stringify(data.settings));
        }
 
        // 从本地存储加载数据
        function loadData() {
            // 加载参与者名单
            const savedParticipants = localStorage.getItem('lotteryParticipants');
            if (savedParticipants) {
                try {
                    data.participants = JSON.parse(savedParticipants);
                } catch (e) {
                    console.error('加载参与者名单失败:', e);
                }
            }
             
            // 加载中奖记录
            const savedWinners = localStorage.getItem('lotteryWinners');
            if (savedWinners) {
                try {
                    data.winners = JSON.parse(savedWinners);
                } catch (e) {
                    console.error('加载中奖记录失败:', e);
                }
            }
             
            // 加载设置
            const savedSettings = localStorage.getItem('lotterySettings');
            if (savedSettings) {
                try {
                    const loadedSettings = JSON.parse(savedSettings);
                    data.settings = { ...data.settings, ...loadedSettings };
                } catch (e) {
                    console.error('加载设置失败:', e);
                }
            }
            
            // 加载上次抽奖时间
            const savedLastDrawTime = localStorage.getItem('lastDrawTime');
            if (savedLastDrawTime) {
                data.lastDrawTime = savedLastDrawTime;
            }
            
            // 加载剩余抽奖次数
            const savedDrawsLeft = localStorage.getItem('drawsLeft');
            if (savedDrawsLeft) {
                data.drawsLeft = parseInt(savedDrawsLeft);
            }
        }
 
        // 绑定事件监听器
        function bindEventListeners() {
            // 抽奖控制
            elements.startButton.addEventListener('click', startLottery);
            elements.stopButton.addEventListener('click', stopLottery);
             
            // 界面切换
            elements.viewWinnersButton.addEventListener('click', () => {
                elements.winnersScreen.classList.remove('hidden');
            });
            elements.backToMainButton.addEventListener('click', () => {
                elements.winnersScreen.classList.add('hidden');
            });
             
            // 中奖名单操作
            elements.clearWinnersButton.addEventListener('click', clearWinners);
             
            // 键盘快捷键
            document.addEventListener('keydown', (e) => {
                // Enter 开始/停止抽奖
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (state.isDrawing) {
                        stopLottery();
                    } else if (state.canDraw) {
                        startLottery();
                    }
                }
                 
                // Backspace 返回主窗口
                if (e.key === 'Backspace') {
                    if (!elements.winnersScreen.classList.contains('hidden')) {
                        elements.winnersScreen.classList.add('hidden');
                    }
                }
            });
            
            // 触摸事件支持
            elements.lotteryContainer.addEventListener('touchstart', (e) => {
                if (state.isDrawing) {
                    stopLottery();
                } else if (state.canDraw) {
                    startLottery();
                }
            });
        }
 
        // 初始化应用
        function init() {
            // 加载数据
            loadData();
            
            // 更新奖品显示
            updatePrizeDisplay();
             
            // 更新显示
            updateWinnersList();
            
            // 检查抽奖状态
            checkDrawAvailability();
             
            // 绑定事件监听器
            bindEventListeners();
            
            // 如果没有参与者，加载示例
            if (data.participants.length === 0) {
                loadExampleParticipants();
            }
        }
 
        // 启动应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>





